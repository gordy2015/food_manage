
{% extends 'back/master.html' %}
{% load fee %}

{% block title %} 餐厅订单详情 {% endblock %}

{% block body %}
          <div class="cont">

          <h3>订单详情</h3>
          <div>
                <form>
                    <table id="mexample"  cellpadding="0" cellspacing="0" border="0" width="100%">
                    <thead>
                            <tr>
                                <td>编号</td>
                                <td>菜名</td>
                                <td>单价</td>
                                <td>数量</td>
                                <td>费用</td>
                                <td>操作</td>
                            </tr>
                    </thead>
                    <tbody>
                    {% for s in od %}
                            <tr tid="{{ row.id }}">
                            <td>{{ forloop.counter }}</td>
                            <td>{{ s.food_cho.foodname }}</td>
                            <td>{{ s.food_cho.price }}</td>
                            <td>{{ s.food_count }}</td>
                            <td class="feec">{% singlefee s.food_cho.price s.food_count %}</td>
                            <td><a class="single_edit">编辑</a>|<a class="single_del">删除</a></td>
                            </tr>
                    {% endfor %}
                    </tbody>
                    </table>
                    <div> <span id="allfee">合计总费用</span>    | 结算| 取消</div>
                    <p id="err_order_edit_ajax" style="color: red"></p>
                </form>
            </div>
            <div><a href="/back/order/">返回</a> </div>


            <div class="shade hide"></div>
            <div class="singleedit-modal hide">
                <form id="singleedit_form">
                    <table id="mexample"  cellpadding="0" cellspacing="0" border="0" width="100%">
                        <input type="text" name="tid" hidden>
                        <input type="text" name="foodname" placeholder="菜名">
                        <input type="text" name="food_count" placeholder="数量">
                        <a>确认修改 | 取消</a>
                    </table>
                    <p id="err_order_edit_ajax" style="color: red"></p>
                </form>
            </div>
        </div>
{% endblock %}



{% block js %}
    <script>
        $(function () {
            $('.single_edit').click(function () {
                $('.singleedit-modal,.shade').removeClass('hide');
                var tid = $(this).parent().parent().attr("tid");
                $('#singleedit_form').find('input[name="tid"]').val(tid);
            })


{#            $('.single_del').click(function () {#}
{#                $('.orderedit-modal,.shade').addClass('hide')#}
{#                $('#err_order_manage_ajax').text('')#}
{#            });#}
        });


{##}
{#        $('#orderadd').click(function () {#}
{#            $.ajax({#}
{#                url: "/back/order_add_ajax/",#}
{#                type: "POST",#}
{#                data: $('#orderadd_form').serialize(),#}
{#                beforeSend: function(xhr,settings){#}
{#                    xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));#}
{#                },#}
{#                success: function (data) {#}
{#                    var obj = JSON.parse(data);#}
{#                    console.log(obj.status);#}
{#                    if(obj.status){#}
{#                        location.reload()#}
{#                    }else {#}
{#                        $('#err_foodtype_edit_ajax').text(obj.error)#}
{#                    }#}
{#                }#}
{#            })#}
{#        });#}

{#        $('#foodtypeedit_confirm').click(function () {#}
{#            $.ajax({#}
{#                url: "/back/table_edit_ajax/",#}
{#                type: "POST",#}
{#                data: $('#foodtypeedit_form').serialize(),#}
{#                beforeSend: function(xhr,settings){#}
{#                    xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));#}
{#                },#}
{#                success: function (data) {#}
{#                    var obj = JSON.parse(data);#}
{#                    console.log(obj.status);#}
{#                    if(obj.status){#}
{#                        location.reload()#}
{#                    }else {#}
{#                        $('#err_foodtype_edit_ajax').text(obj.error)#}
{#                    }#}
{#                }#}
{#            })#}
{#        });#}
{##}
{#        $('.orderdel').click(function () {#}
{#            if (confirm("确认要删除？")) {#}
{#                $.ajax({#}
{#                    url: "/back/order_del_ajax/",#}
{#                    type: "POST",#}
{#                    data: {id: $(this).parent().parent().attr("tid")},#}
{#                    beforeSend: function(xhr,settings){#}
{#                        xhr.setRequestHeader('X-CSRFtoken', $.cookie('csrftoken'));#}
{#                    },#}
{#                    success: function (data) {#}
{#                        var obj = JSON.parse(data);#}
{#                        if(obj.status){#}
{#                            alert(obj.error);#}
{#                            location.reload()#}
{#                        }else {#}
{#                            alert(obj.error);#}
{#                        }#}
{#                   }#}
{#                })#}
{#            }#}
{#        });#}
{##}
{##}
{##}
{##}


        $(document).ready(function() {
            $('#example').dataTable();
            $('#mexample').dataTable();

            var m = $('.feec');
            var i;
            var x = Number(0);
            for (i = 0; i < m.length; i++) {
                x = x + Number(m.eq(i).text());
            };
            x = '合计总费用：' + String(x) + '元';
            $('#allfee').text(x);
        });

    </script>

{% endblock %}